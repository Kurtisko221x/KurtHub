<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio - Rodinn√° AI Platforma | 10 AI N√°strojov</title>
    <meta name="description" content="Komplexn√° AI platforma s 10 funkciami: Chat, Grafy, Obr√°zky, PowerPoint, PDF, Quiz a viac. Pre cel√∫ rodinu.">
    <meta name="keywords" content="AI, ChatGPT, DALL-E, PowerPoint, PDF generator, AI tools, Slovakia">
    <meta name="author" content="AI Studio Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="AI Studio - Rodinn√° AI Platforma">
    <meta property="og:description" content="10 AI n√°strojov v jednej aplik√°cii. Chat, Grafy, Obr√°zky, Prezent√°cie a viac.">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=AI+Studio">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI Studio - Rodinn√° AI Platforma">
    <meta name="twitter:description" content="10 AI n√°strojov v jednej aplik√°cii.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
        
        /* Dark/Light mode colors */
        :root[data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: rgba(139, 92, 246, 0.2);
        }
        
        :root[data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: rgba(139, 92, 246, 0.3);
        }
        
        /* Loading progress bar */
        @keyframes progressBar {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        .progress-bar {
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            animation: progressBar 2s ease-in-out infinite;
        }
        
        /* Avatars */
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .avatar-user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .avatar-ai {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
        }
        
        /* Markdown styling */
        .markdown-content h1 { font-size: 2em; font-weight: bold; margin: 0.5em 0; }
        .markdown-content h2 { font-size: 1.5em; font-weight: bold; margin: 0.5em 0; }
        .markdown-content h3 { font-size: 1.25em; font-weight: bold; margin: 0.5em 0; }
        .markdown-content p { margin: 0.5em 0; line-height: 1.6; }
        .markdown-content ul, .markdown-content ol { margin: 0.5em 0; padding-left: 1.5em; }
        .markdown-content li { margin: 0.25em 0; }
        .markdown-content code { 
            background: rgba(139, 92, 246, 0.1); 
            padding: 2px 6px; 
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .markdown-content pre {
            background: #1e293b;
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
        .markdown-content strong { font-weight: 700; }
        .markdown-content em { font-style: italic; }
        .markdown-content blockquote {
            border-left: 4px solid #8b5cf6;
            padding-left: 1em;
            margin: 1em 0;
            color: #94a3b8;
        }
        
        /* Scroll animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .fade-in-up-delay-1 {
            animation: fadeInUp 0.6s ease-out 0.1s forwards;
            opacity: 0;
        }
        
        .fade-in-up-delay-2 {
            animation: fadeInUp 0.6s ease-out 0.2s forwards;
            opacity: 0;
        }
        
        /* Smooth loading */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        body {
            animation: fadeIn 0.5s ease-in;
        }
        
        /* Better contrast for hero */
        .hero-text {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        /* Mobile responsive improvements */
        @media (max-width: 768px) {
            .hero-text {
                font-size: 2rem !important;
            }
            .tool-card {
                padding: 1rem !important;
            }
        }
        
        /* Accessibility - better focus states */
        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible {
            outline: 2px solid #8b5cf6;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Stav aplik√°cie
        let state = {
            chats: [{ id: 1, title: 'Nov√Ω ƒçet', messages: [] }],
            activeChat: 1,
            input: '',
            isLoading: false,
            sidebarOpen: true,
            mode: 'chat', // 'chat', 'chart', 'image', 'analyze-image', 'code', 'humanize', 'presentation', 'summarizer', 'pdf', 'quiz'
            imageSize: '1024x1024',
            imageQuality: 'standard',
            chartType: 'bar',
            chartData: null,
            uploadedImage: null,
            useTextEditor: false, // prep√≠nanie medzi input a textarea
            theme: localStorage.getItem('theme') || 'dark' // dark alebo light
        };
        
        // Nastav t√©mu pri naƒç√≠tan√≠
        document.documentElement.setAttribute('data-theme', state.theme);

        const tools = [
            { title: 'Chat s AI', desc: 'Prirozden√° konverz√°cia s AI modelom', icon: 'üí¨', mode: 'chat' },
            { title: 'Vizualiz√°cia d√°t', desc: 'Vytv√°raj profesion√°lne grafy', icon: 'üìä', mode: 'chart' },
            { title: 'Generovanie obr√°zkov', desc: 'DALL-E 3 AI gener√°tor', icon: 'üé®', mode: 'image' },
            { title: 'Anal√Ωza obr√°zkov', desc: 'Nahraj obr√°zok na anal√Ωzu', icon: 'üñºÔ∏è', mode: 'analyze-image' },
            { title: 'PowerPoint prezent√°cie', desc: 'Skutoƒçn√© .pptx s√∫bory', icon: 'üìΩÔ∏è', mode: 'presentation' },
            { title: 'Pomoc s k√≥dom', desc: 'Code review a debugging', icon: 'üíª', mode: 'code' },
            { title: 'Humaniz√°tor', desc: 'Prep√≠≈° text prirodzene', icon: '‚ú®', mode: 'humanize' },
            { title: 'Summarizer', desc: 'Zhrnutie dlh√Ωch textov', icon: 'üìù', mode: 'summarizer' },
            { title: 'PDF Generator', desc: 'Fakt√∫ry a dokumenty', icon: 'üìÑ', mode: 'pdf' },
            { title: 'Quiz Generator', desc: 'Testy z uƒçiva', icon: '‚ùì', mode: 'quiz' }
        ];

        function getCurrentChat() {
            return state.chats.find(c => c.id === state.activeChat);
        }

        function createNewChat() {
            const newId = Math.max(...state.chats.map(c => c.id)) + 1;
            state.chats.unshift({ id: newId, title: 'Nov√Ω ƒçet', messages: [] });
            state.activeChat = newId;
            render();
        }
        
        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', state.theme);
            document.documentElement.setAttribute('data-theme', state.theme);
            render();
        }
        
        function formatMarkdown(text) {
            // Nastav marked options
            marked.setOptions({
                breaks: true,
                gfm: true,
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        try {
                            return hljs.highlight(code, { language: lang }).value;
                        } catch (err) {}
                    }
                    return hljs.highlightAuto(code).value;
                }
            });
            return marked.parse(text);
        }

        async function sendMessage() {
            if (state.mode === 'image') {
                generateImage();
                return;
            }

            if (state.mode === 'chart') {
                generateChart();
                return;
            }

            if (state.mode === 'analyze-image') {
                analyzeImage();
                return;
            }

            if (state.mode === 'humanize') {
                humanizeText();
                return;
            }

            if (state.mode === 'code') {
                reviewCode();
                return;
            }

            if (state.mode === 'presentation') {
                generatePresentation();
                return;
            }

            if (state.mode === 'summarizer') {
                summarizeText();
                return;
            }

            if (state.mode === 'pdf') {
                generatePDF();
                return;
            }

            if (state.mode === 'quiz') {
                generateQuiz();
                return;
            }

            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const userMsg = { role: 'user', content: state.input };
            chat.messages.push(userMsg);
            
            if (chat.messages.length === 1) {
                chat.title = state.input.substring(0, 30) + (state.input.length > 30 ? '...' : '');
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: chat.messages,
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function generateImage() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const prompt = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üé® Generuj obr√°zok: ' + prompt 
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üé® ' + prompt.substring(0, 25) + (prompt.length > 25 ? '...' : '');
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        size: state.imageSize,
                        quality: state.imageQuality
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.data[0].url,
                    isImage: true,
                    imagePrompt: prompt
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function analyzeImage() {
            if (!state.uploadedImage && !state.input.trim()) {
                alert('Nahrajte obr√°zok alebo vlo≈æte URL!');
                return;
            }
            
            const chat = getCurrentChat();
            const prompt = state.input.trim() || 'Analyzuj tento obr√°zok a pop√≠≈° ƒço vid√≠≈°.';
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üñºÔ∏è Anal√Ωza obr√°zka: ' + prompt,
                imageUrl: state.uploadedImage
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üñºÔ∏è ' + prompt.substring(0, 25) + '...';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const messages = [
                    {
                        role: 'user',
                        content: [
                            { type: 'text', text: prompt },
                            { type: 'image_url', image_url: { url: state.uploadedImage } }
                        ]
                    }
                ];

                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: messages,
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.uploadedImage = null;
            state.isLoading = false;
            render();
        }

        async function humanizeText() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const textToHumanize = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: '‚ú® Humanizuj text: ' + textToHumanize 
            });
            
            if (chat.messages.length === 1) {
                chat.title = '‚ú® Humaniz√°tor';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Si expert na prepisovanie textov. Tvoja √∫loha je prep√≠sa≈• text tak, aby znel prirodzene, ƒæudsky a nebol rozpoznateƒæn√Ω ako AI generovan√Ω. Zachovaj v√Ωznam, ale zme≈à formul√°cie, pridaj osobnos≈•, emocion√°lnos≈• a variabilitu vo vet√°ch. Nepou≈æ√≠vaj ≈°tandardn√© AI fr√°zy.'
                            },
                            {
                                role: 'user',
                                content: 'Prep√≠≈° tento text prirodzenej≈°ie a ƒæudskej≈°ie:\n\n' + textToHumanize
                            }
                        ],
                        temperature: 0.9,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function reviewCode() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const codeInput = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üíª Code review: ' + codeInput 
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üíª Code Review';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Si sk√∫sen√Ω program√°tor a code reviewer. Analyzuj k√≥d, poukazuj na chyby, bezpeƒçnostn√© probl√©my, mo≈æn√© vylep≈°enia a best practices. Vysvetƒæuj jasne a zrozumiteƒæne.'
                            },
                            {
                                role: 'user',
                                content: codeInput
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function generatePresentation() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const topic = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üìΩÔ∏è Vytvor PowerPoint prezent√°ciu: ' + topic 
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üìΩÔ∏è ' + topic.substring(0, 25) + '...';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                // Generuj skutoƒçn√Ω PowerPoint s√∫bor
                const response = await fetch('http://localhost:3000/api/generate-pptx', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic: topic })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API Error');
                }

                // Stiahni PPTX s√∫bor
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `prezentacia-${Date.now()}.pptx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                chat.messages.push({
                    role: 'assistant',
                    content: '‚úÖ PowerPoint prezent√°cia bola vygenerovan√° a stiahnut√°!\n\nüì• S√∫bor: prezentacia.pptx\nüéØ T√©ma: ' + topic + '\n\nüí° Otvorte s√∫bor v Microsoft PowerPoint, Google Slides alebo LibreOffice Impress.',
                    isPptxDownloaded: true
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function summarizeText() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const textToSummarize = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üìù Zhrn√∫≈• text: ' + textToSummarize.substring(0, 100) + '...'
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üìù Summarizer';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Si expert na zhrnutie textov. Vytvor kr√°tke, v√Ωsti≈æn√© zhrnutie textu. Zachovaj kƒæ√∫ƒçov√© inform√°cie a hlavn√© body. Zhrnutie by malo by≈• 5-10x krat≈°ie ako origin√°l. Pou≈æi odr√°≈æky pre prehƒæadnos≈•.'
                            },
                            {
                                role: 'user',
                                content: 'Zhrn√∫≈• tento text:\n\n' + textToSummarize
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: 'üìù **Zhrnutie:**\n\n' + data.choices[0].message.content + '\n\n---\n\nüí° **P√¥vodn√° dƒ∫≈æka:** ' + textToSummarize.length + ' znakov\n‚ú® **Zhrnutie:** ' + data.choices[0].message.content.length + ' znakov'
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function generatePDF() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const pdfRequest = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üìÑ Vytvor PDF: ' + pdfRequest 
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üìÑ PDF Generator';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/generate-pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ request: pdfRequest })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API Error');
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dokument-${Date.now()}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                chat.messages.push({
                    role: 'assistant',
                    content: '‚úÖ PDF dokument bol vygenerovan√Ω a stiahnut√Ω!\n\nüì• S√∫bor: dokument.pdf\nüìù Typ: ' + pdfRequest + '\n\nüí° Otvorte s√∫bor v PDF prehliadaƒçi.',
                    isPdfDownloaded: true
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        async function generateQuiz() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const learningMaterial = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: '‚ùì Vytvor kv√≠z z: ' + learningMaterial.substring(0, 100) + '...'
            });
            
            if (chat.messages.length === 1) {
                chat.title = '‚ùì Quiz Generator';
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Si uƒçiteƒæ. Vytvor vzdel√°vac√≠ kv√≠z s 10 ot√°zkami z poskytnut√©ho uƒçebn√©ho materi√°lu. Ka≈æd√° ot√°zka mus√≠ ma≈• 4 mo≈ænosti (A, B, C, D) a spr√°vnu odpoveƒè na konci. Form√°t:\n\n1. Ot√°zka?\nA) mo≈ænos≈•\nB) mo≈ænos≈•\nC) mo≈ænos≈•\nD) mo≈ænos≈•\n\nNa konci daj: "‚úÖ SPR√ÅVNE ODPOVEDE:" a vyp√≠≈° ich.'
                            },
                            {
                                role: 'user',
                                content: 'Vytvor kv√≠z z tohto uƒçebn√©ho materi√°lu:\n\n' + learningMaterial
                            }
                        ],
                        temperature: 0.5,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content,
                    isQuiz: true
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
        }

        function downloadPresentation(htmlContent, filename) {
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename || 'prezentacia.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.uploadedImage = e.target.result;
                    render();
                };
                reader.readAsDataURL(file);
            }
        }

        async function generateChart() {
            if (!state.input.trim() || state.isLoading) return;

            const chat = getCurrentChat();
            const userPrompt = state.input;
            
            chat.messages.push({ 
                role: 'user', 
                content: 'üìä Vytvor graf: ' + userPrompt 
            });
            
            if (chat.messages.length === 1) {
                chat.title = 'üìä ' + userPrompt.substring(0, 25) + (userPrompt.length > 25 ? '...' : '');
            }

            state.input = '';
            state.isLoading = true;
            render();

            try {
                // P√Ωtame AI aby vytvorila JSON d√°ta pre graf
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Si pomocn√≠k pre vytv√°ranie grafov. Pou≈æ√≠vateƒæ ti povie ak√© d√°ta chce vizualizova≈•.\n\nD√îLE≈ΩIT√â PRAVIDL√Å:\n1. Ak s√∫ dve d√°tov√© sady s veƒæmi odli≈°n√Ωmi mierkami (rozdiel >5x), V≈ΩDY pou≈æi dve osi Y.\n2. Ak pou≈æ√≠vateƒæ povie "dve osi Y", "sekund√°rna os", "druh√° os Y", pou≈æi dve osi.\n3. Pre grafy s dvoma osami: prv√Ω dataset m√° "yAxisID": "y", druh√Ω m√° "yAxisID": "y1".\n4. Pre stƒ∫pcov√© grafy pou≈æi type "bar", pre ƒçiarov√© "line".\n5. M√¥≈æe≈° kombinova≈• typy v jednom grafe (napr. stƒ∫pce + ƒçiara).\n\nForm√°t odpovede (V≈ΩDY iba validn√Ω JSON):\n{"type": "bar|line|pie|doughnut", "title": "N√°zov", "labels": ["L1","L2"], "datasets": [{"label": "Dataset 1", "data": [10,20], "type": "bar", "yAxisID": "y"}, {"label": "Dataset 2", "data": [100,200], "type": "line", "yAxisID": "y1"}], "dualAxis": true}\n\nAk je iba jedna os: "dualAxis": false a v≈°etky datasety maj√∫ "yAxisID": "y".'
                            },
                            {
                                role: 'user',
                                content: userPrompt
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'API Error');
                }

                let chartConfig;
                try {
                    // Pok√∫s sa extrahova≈• JSON z odpovede
                    let jsonText = data.choices[0].message.content.trim();
                    // Odstr√°≈à markdown code blocky ak existuj√∫
                    jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    chartConfig = JSON.parse(jsonText);
                } catch (e) {
                    throw new Error('AI nevr√°tila validn√Ω form√°t grafu. Sk√∫ste in√∫ formul√°ciu po≈æiadavky.');
                }

                chat.messages.push({
                    role: 'assistant',
                    content: JSON.stringify(chartConfig),
                    isChart: true,
                    chartConfig: chartConfig,
                    chartId: 'chart-' + Date.now()
                });
            } catch (error) {
                chat.messages.push({
                    role: 'assistant',
                    content: '‚ùå Chyba: ' + error.message,
                    isError: true
                });
            }

            state.isLoading = false;
            render();
            
            // Vykresl√≠me grafy po renderi
            setTimeout(() => {
                chat.messages.forEach(m => {
                    if (m.isChart && m.chartId) {
                        const canvas = document.getElementById(m.chartId);
                        if (canvas && !canvas.chart) {
                            createChartOnCanvas(canvas, m.chartConfig);
                        }
                    }
                });
            }, 100);
        }

        function createChartOnCanvas(canvas, config) {
            if (canvas.chart) {
                canvas.chart.destroy();
            }

            const colors = [
                'rgba(139, 92, 246, 0.8)',  // purple - fialov√°
                'rgba(236, 72, 153, 0.8)',  // pink - ru≈æov√°
                'rgba(59, 130, 246, 0.8)',  // blue - modr√°
                'rgba(34, 197, 94, 0.8)',   // green - zelen√°
                'rgba(251, 146, 60, 0.8)',  // orange - oran≈æov√°
                'rgba(239, 68, 68, 0.8)',   // red - ƒçerven√°
                'rgba(168, 85, 247, 0.8)',  // violet - fialkov√°
                'rgba(14, 165, 233, 0.8)'   // sky - nebeskn√°
            ];

            const datasets = config.datasets.map((dataset, idx) => {
                const color = dataset.backgroundColor || colors[idx % colors.length];
                const borderColor = dataset.borderColor || color.replace('0.8', '1');
                
                return {
                    ...dataset,
                    backgroundColor: color,
                    borderColor: borderColor,
                    borderWidth: dataset.type === 'line' ? 3 : 2,
                    tension: dataset.type === 'line' ? 0.4 : 0,
                    pointRadius: dataset.type === 'line' ? 5 : 0,
                    pointHoverRadius: dataset.type === 'line' ? 7 : 0,
                    pointBackgroundColor: borderColor,
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    fill: dataset.type === 'line' ? false : true
                };
            });

            // Kontrola ƒçi potrebujeme dve osi Y
            const needsDualAxis = config.dualAxis === true;
            const isPieOrDoughnut = config.type === 'pie' || config.type === 'doughnut';

            // Nastavenie os√≠
            let scalesConfig = {};
            if (!isPieOrDoughnut) {
                scalesConfig = {
                    x: {
                        ticks: { color: '#fff', font: { size: 12 } },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                        ticks: { 
                            color: needsDualAxis ? datasets[0].borderColor : '#fff',
                            font: { size: 12, weight: needsDualAxis ? 'bold' : 'normal' }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: needsDualAxis && datasets[0] ? {
                            display: true,
                            text: datasets[0].label,
                            color: datasets[0].borderColor,
                            font: { size: 13, weight: 'bold' }
                        } : undefined
                    }
                };

                // Pridanie druhej osi Y ak je potrebn√°
                if (needsDualAxis && datasets.length > 1) {
                    scalesConfig.y1 = {
                        type: 'linear',
                        position: 'right',
                        ticks: { 
                            color: datasets[1].borderColor,
                            font: { size: 12, weight: 'bold' }
                        },
                        grid: { 
                            drawOnChartArea: false // iba prav√° os, nie kresli≈• cez graf
                        },
                        title: {
                            display: true,
                            text: datasets[1].label,
                            color: datasets[1].borderColor,
                            font: { size: 13, weight: 'bold' }
                        }
                    };
                }
            }

            canvas.chart = new Chart(canvas, {
                type: config.type || 'bar',
                data: {
                    labels: config.labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: config.title,
                            color: '#fff',
                            font: { size: 18, weight: 'bold' },
                            padding: 20
                        },
                        legend: {
                            labels: { 
                                color: '#fff',
                                font: { size: 13 },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            padding: 12,
                            displayColors: true
                        }
                    },
                    scales: scalesConfig
                }
            });
        }

        function downloadChart(chartId) {
            const canvas = document.getElementById(chartId);
            if (canvas) {
                const url = canvas.toDataURL('image/png');
                const a = document.createElement('a');
                a.href = url;
                a.download = 'graf-' + Date.now() + '.png';
                a.click();
            }
        }

        function render() {
            const chat = getCurrentChat();
            const app = document.getElementById('app');
            
            const bgGradient = state.theme === 'dark' 
                ? 'bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900' 
                : 'bg-gradient-to-br from-slate-50 via-purple-50 to-slate-50';
            
            const textColor = state.theme === 'dark' ? 'text-white' : 'text-slate-900';
            
            app.innerHTML = `
                <div class="flex h-screen ${bgGradient} ${textColor}">
                    <!-- Sidebar -->
                    <div class="${state.sidebarOpen ? 'w-64' : 'w-0'} transition-all duration-300 bg-slate-800/50 backdrop-blur-sm border-r border-purple-500/20 overflow-hidden">
                        <div class="p-4">
                            <div class="flex items-center gap-2 mb-6">
                                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-2xl">‚ú®</div>
                                <span class="font-bold text-lg">AI Studio</span>
                            </div>
                            
                            <button onclick="createNewChat()" class="w-full bg-purple-600 hover:bg-purple-700 rounded-lg px-4 py-3 flex items-center gap-2 mb-4 transition-colors">
                                <span class="text-xl">‚ûï</span>
                                <span>Nov√Ω ƒçet</span>
                            </button>

                            <div class="space-y-1 max-h-[calc(100vh-200px)] overflow-y-auto">
                                ${state.chats.map(c => `
                                    <button onclick="state.activeChat = ${c.id}; render();" class="w-full text-left px-3 py-2 rounded-lg transition-colors ${state.activeChat === c.id ? 'bg-purple-600/50' : 'hover:bg-slate-700/50'}">
                                        <div class="text-sm font-medium truncate">${c.title}</div>
                                        <div class="text-xs text-slate-400">${c.messages.length} spr√°v</div>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Main -->
                    <div class="flex-1 flex flex-col">
                        <!-- Header -->
                        <div class="bg-slate-800/30 backdrop-blur-sm border-b border-purple-500/20 p-4 flex items-center gap-3">
                            <button onclick="state.sidebarOpen = !state.sidebarOpen; render();" class="p-2 hover:bg-slate-700/50 rounded-lg">
                                <span class="text-xl">‚ò∞</span>
                            </button>
                            <h1 class="text-xl font-semibold">${chat.title}</h1>
                            
                            <div class="ml-auto flex gap-2 overflow-x-auto items-center">
                                <!-- Theme Toggle -->
                                <button onclick="toggleTheme()" class="p-2 hover:bg-slate-700/50 rounded-lg transition-colors" title="Prepn√∫≈• t√©mu">
                                    <span class="text-xl">${state.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô'}</span>
                                </button>
                                
                                <!-- Separator -->
                                <div class="h-6 w-px bg-slate-600"></div>
                                <button onclick="state.mode = 'chat'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'chat' ? 'bg-purple-600 shadow-lg shadow-purple-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Chat
                                </button>
                                <button onclick="state.mode = 'chart'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'chart' ? 'bg-blue-600 shadow-lg shadow-blue-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Grafy
                                </button>
                                <button onclick="state.mode = 'image'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'image' ? 'bg-pink-600 shadow-lg shadow-pink-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Obr√°zky
                                </button>
                                <button onclick="state.mode = 'analyze-image'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'analyze-image' ? 'bg-indigo-600 shadow-lg shadow-indigo-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Anal√Ωza
                                </button>
                                <button onclick="state.mode = 'code'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'code' ? 'bg-green-600 shadow-lg shadow-green-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    K√≥d
                                </button>
                                <button onclick="state.mode = 'humanize'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'humanize' ? 'bg-yellow-600 shadow-lg shadow-yellow-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Humaniz√°tor
                                </button>
                                <button onclick="state.mode = 'presentation'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'presentation' ? 'bg-red-600 shadow-lg shadow-red-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Prezent√°cia
                                </button>
                                <button onclick="state.mode = 'summarizer'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'summarizer' ? 'bg-teal-600 shadow-lg shadow-teal-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Summarizer
                                </button>
                                <button onclick="state.mode = 'pdf'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'pdf' ? 'bg-orange-600 shadow-lg shadow-orange-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    PDF
                                </button>
                                <button onclick="state.mode = 'quiz'; render();" class="px-3 py-1.5 rounded-md transition-all text-xs font-medium whitespace-nowrap ${state.mode === 'quiz' ? 'bg-cyan-600 shadow-lg shadow-cyan-500/50' : 'bg-slate-700/50 hover:bg-slate-600/70 border border-slate-600'}">
                                    Quiz
                                </button>
                            </div>
                        </div>

                        <!-- Messages -->
                        <div class="flex-1 overflow-y-auto p-6" id="messages">
                            ${chat.messages.length === 0 ? `
                                <div class="max-w-5xl mx-auto">
                                    <!-- Hero Section -->
                                    <div class="text-center mb-16 mt-12 fade-in-up">
                                        <h1 class="text-5xl md:text-6xl font-bold mb-6 hero-text">
                                            <span class="bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 bg-clip-text text-transparent animate-gradient">
                                                AI Studio
                                            </span>
                                        </h1>
                                        <p class="text-xl md:text-2xl mb-4 hero-text font-medium ${textColor === 'text-white' ? 'text-slate-100' : 'text-slate-800'}">
                                            Komplexn√° AI platforma pre va≈°u rodinu
                                        </p>
                                        <p class="text-base md:text-lg ${textColor === 'text-white' ? 'text-slate-300' : 'text-slate-600'} mb-8">
                                            10 v√Ωkonn√Ωch AI n√°strojov v jednej aplik√°cii
                                        </p>
                                        
                                        <!-- CTA Buttons -->
                                        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-12 fade-in-up-delay-1">
                                            <button onclick="state.mode = 'chat'; render();" 
                                                class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold text-white shadow-lg shadow-purple-500/50 transition-all transform hover:scale-105">
                                                üöÄ Zaƒça≈• pou≈æ√≠va≈•
                                            </button>
                                            <button onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})" 
                                                class="px-8 py-4 bg-slate-700/50 hover:bg-slate-600/70 rounded-xl font-semibold ${textColor} border border-slate-600 transition-all">
                                                üìö Zisti≈• viac
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Features Section -->
                                    <div id="features" class="mb-12 fade-in-up-delay-2">
                                        <h2 class="text-3xl md:text-4xl font-bold mb-8 text-center ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'}">
                                            ‚ú® Dostupn√© funkcie
                                        </h2>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            ${tools.map((t, i) => `
                                                <div class="tool-card bg-slate-800/50 backdrop-blur-sm border border-purple-500/20 rounded-xl p-6 text-left hover:border-purple-500/40 hover:shadow-lg hover:shadow-purple-500/20 transition-all transform hover:-translate-y-1">
                                                    <div class="text-4xl mb-4">${t.icon}</div>
                                                    <h3 class="text-lg font-semibold mb-2 ${textColor}">${t.title}</h3>
                                                    <p class="text-sm ${textColor === 'text-white' ? 'text-slate-400' : 'text-slate-600'}">${t.desc}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <!-- About Section -->
                                    <div class="bg-slate-800/30 rounded-2xl p-8 md:p-10 border border-purple-500/20 mb-12 fade-in-up-delay-2">
                                        <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'}">
                                            üéØ O AI Studio
                                        </h2>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm md:text-base">
                                            <div>
                                                <h3 class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-3">üíª Technol√≥gie</h3>
                                                <ul class="space-y-2 ${textColor === 'text-white' ? 'text-slate-300' : 'text-slate-700'}">
                                                    <li>‚Ä¢ Node.js + Express (Backend)</li>
                                                    <li>‚Ä¢ OpenAI API (GPT-4o-mini, DALL-E 3)</li>
                                                    <li>‚Ä¢ Chart.js (Grafy)</li>
                                                    <li>‚Ä¢ PptxGenJS (PowerPoint)</li>
                                                    <li>‚Ä¢ PDFKit (Dokumenty)</li>
                                                    <li>‚Ä¢ Vanilla JS + Tailwind CSS</li>
                                                </ul>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-3">üé® Features</h3>
                                                <ul class="space-y-2 ${textColor === 'text-white' ? 'text-slate-300' : 'text-slate-700'}">
                                                    <li>‚Ä¢ Dark/Light Mode</li>
                                                    <li>‚Ä¢ Markdown Support</li>
                                                    <li>‚Ä¢ Syntax Highlighting</li>
                                                    <li>‚Ä¢ Progress Animations</li>
                                                    <li>‚Ä¢ Responsive Design</li>
                                                    <li>‚Ä¢ 10 AI N√°strojov</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- How to Start -->
                                    <div class="bg-slate-800/30 rounded-xl p-6 md:p-8 border border-purple-500/20 mb-8 fade-in-up-delay-2">
                                        <h3 class="text-xl md:text-2xl font-bold mb-6 text-center ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'}">üöÄ Ako zaƒça≈•?</h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm md:text-base">
                                            <div class="flex items-start gap-4">
                                                <div class="flex-shrink-0 w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center font-bold text-white">1</div>
                                                <div>
                                                    <p class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-1">Vyberte funkciu</p>
                                                    <p class="${textColor === 'text-white' ? 'text-slate-400' : 'text-slate-600'}">Kliknite na tlaƒçidlo v hornom menu</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start gap-4">
                                                <div class="flex-shrink-0 w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center font-bold text-white">2</div>
                                                <div>
                                                    <p class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-1">Zadajte po≈æiadavku</p>
                                                    <p class="${textColor === 'text-white' ? 'text-slate-400' : 'text-slate-600'}">Nap√≠≈°te ƒço potrebujete</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start gap-4">
                                                <div class="flex-shrink-0 w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center font-bold text-white">3</div>
                                                <div>
                                                    <p class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-1">Z√≠skajte v√Ωsledok</p>
                                                    <p class="${textColor === 'text-white' ? 'text-slate-400' : 'text-slate-600'}">AI sprav√≠ svoju m√°giu ‚ú®</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start gap-4">
                                                <div class="flex-shrink-0 w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center font-bold text-white">4</div>
                                                <div>
                                                    <p class="font-semibold ${textColor === 'text-white' ? 'text-purple-300' : 'text-purple-600'} mb-1">Stiahnite si ho</p>
                                                    <p class="${textColor === 'text-white' ? 'text-slate-400' : 'text-slate-600'}">Grafy, prezent√°cie, obr√°zky...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="max-w-3xl mx-auto space-y-6">
                                    ${chat.messages.map(m => `
                                        <div class="flex gap-3 ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                                            ${m.role === 'user' ? '' : `
                                                <div class="avatar avatar-ai">
                                                    <span>ü§ñ</span>
                                                </div>
                                            `}
                                            <div class="${m.isImage ? 'max-w-full' : 'max-w-[80%]'} rounded-2xl px-6 py-4 ${
                                                m.role === 'user' 
                                                    ? 'bg-gradient-to-br from-purple-600 to-pink-600' 
                                                    : m.isError 
                                                    ? 'bg-red-900/30 border border-red-500/50' 
                                                    : 'bg-slate-800/50 border border-purple-500/20'
                                            }">
                                                ${m.isImage ? `
                                                    <div class="space-y-3">
                                                        <div class="text-sm text-slate-300">‚ú® Vygenerovan√Ω obr√°zok:</div>
                                                        <img src="${m.content}" alt="${m.imagePrompt || 'Vygenerovan√Ω obr√°zok'}" class="rounded-lg w-full max-w-2xl" loading="lazy" />
                                                        <div class="text-xs text-slate-400 italic">"${m.imagePrompt}"</div>
                                                        <a href="${m.content}" target="_blank" class="inline-block mt-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-colors">
                                                            üì• Stiahnu≈• obr√°zok
                                                        </a>
                                                    </div>
                                                ` : m.isChart ? `
                                                    <div class="space-y-3">
                                                        <div class="text-sm text-slate-300">üìä Vygenerovan√Ω graf:</div>
                                                        <div class="bg-slate-900/50 p-4 rounded-lg">
                                                            <canvas id="${m.chartId}" width="600" height="400"></canvas>
                                                        </div>
                                                        <button onclick="downloadChart('${m.chartId}')" class="inline-block mt-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-colors">
                                                            üì• Stiahnu≈• ako PNG
                                                        </button>
                                                    </div>
                                                ` : m.imageUrl ? `
                                                    <div class="space-y-3">
                                                        <img src="${m.imageUrl}" alt="Nahran√Ω obr√°zok na anal√Ωzu" class="rounded-lg max-w-xs" loading="lazy">
                                                        <div class="markdown-content">${formatMarkdown(m.content)}</div>
                                                    </div>
                                                ` : `
                                                    <div class="markdown-content">${m.role === 'assistant' ? formatMarkdown(m.content) : m.content}</div>
                                                `}
                                            </div>
                                            ${m.role === 'user' ? `
                                                <div class="avatar avatar-user">
                                                    <span>üë§</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                    
                                    ${state.isLoading ? `
                                        <div class="flex gap-3 justify-start">
                                            <div class="avatar avatar-ai">
                                                <span>ü§ñ</span>
                                            </div>
                                            <div class="bg-slate-800/50 border border-purple-500/20 rounded-2xl px-6 py-4 w-64">
                                                <div class="text-sm text-slate-400 mb-2">AI p√≠≈°e...</div>
                                                <div class="w-full bg-slate-700/50 rounded-full h-1 overflow-hidden">
                                                    <div class="progress-bar"></div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `}
                        </div>

                        <!-- Input -->
                        <div class="bg-slate-800/30 backdrop-blur-sm border-t border-purple-500/20 p-4">
                            <div class="max-w-3xl mx-auto">
                                ${state.mode === 'image' ? `
                                    <div class="mb-3 flex gap-3">
                                        <select onchange="state.imageSize = this.value" class="bg-slate-700/50 border border-purple-500/30 rounded-lg px-4 py-2 text-white text-sm">
                                            <option value="1024x1024" ${state.imageSize === '1024x1024' ? 'selected' : ''}>1024x1024 (≈†tandard)</option>
                                            <option value="1024x1792" ${state.imageSize === '1024x1792' ? 'selected' : ''}>1024x1792 (V√Ω≈°ka)</option>
                                            <option value="1792x1024" ${state.imageSize === '1792x1024' ? 'selected' : ''}>1792x1024 (≈†√≠rka)</option>
                                        </select>
                                        <select onchange="state.imageQuality = this.value" class="bg-slate-700/50 border border-purple-500/30 rounded-lg px-4 py-2 text-white text-sm">
                                            <option value="standard" ${state.imageQuality === 'standard' ? 'selected' : ''}>≈†tandard</option>
                                            <option value="hd" ${state.imageQuality === 'hd' ? 'selected' : ''}>HD (drah≈°ie)</option>
                                        </select>
                                    </div>
                                ` : ''}
                                ${state.mode === 'chart' ? `
                                    <div class="mb-3 text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3">
                                        üí° <strong>Pr√≠klady:</strong><br>
                                        ‚Ä¢ "Stƒ∫pcov√Ω graf popul√°cie: Bratislava 475000, Ko≈°ice 229000, Pre≈°ov 84000"<br>
                                        ‚Ä¢ "Kol√°ƒçov√Ω graf predaj: jablk√° 150, hru≈°ky 80, ban√°ny 120"<br>
                                        ‚Ä¢ "Graf s dvoma osami Y: mesaƒçn√© tr≈æby stƒ∫pce 10000, 12000, 15000 a ƒçiara poƒçet z√°kazn√≠kov 50, 65, 80"
                                    </div>
                                ` : ''}
                                ${state.mode === 'analyze-image' ? `
                                    <div class="mb-3">
                                        <input type="file" accept="image/*" onchange="handleImageUpload(event)" 
                                            class="bg-slate-700/50 border border-purple-500/30 rounded-lg px-4 py-2 text-white text-sm w-full">
                                        ${state.uploadedImage ? '<div class="mt-2 text-sm text-green-400">‚úì Obr√°zok nahran√Ω</div>' : ''}
                                    </div>
                                ` : ''}
                                
                                <div class="flex gap-2 mb-2">
                                    <button onclick="state.useTextEditor = !state.useTextEditor; render();" 
                                        class="text-sm px-3 py-1 rounded-lg ${state.useTextEditor ? 'bg-purple-600' : 'bg-slate-700/50'} hover:bg-purple-700 transition-colors">
                                        ${state.useTextEditor ? 'üìù Editor zapnut√Ω' : 'üìÑ Prepn√∫≈• na editor'}
                                    </button>
                                </div>
                                
                                <div class="flex gap-3 ${state.useTextEditor ? 'flex-col' : ''}">
                                    ${state.useTextEditor ? `
                                        <textarea 
                                            id="input"
                                            oninput="state.input = this.value"
                                        placeholder="${
                                            state.mode === 'image' ? 'üé® Pop√≠≈°te obr√°zok, ktor√Ω chcete vygenerova≈•...' : 
                                            state.mode === 'chart' ? 'üìä Pop√≠≈°te d√°ta a typ grafu...' :
                                            state.mode === 'humanize' ? '‚ú® Vlo≈æte text na humaniz√°ciu...' :
                                            state.mode === 'code' ? 'üíª Vlo≈æte k√≥d na review...' :
                                            state.mode === 'presentation' ? 'üìΩÔ∏è Zadajte t√©mu prezent√°cie...' :
                                            state.mode === 'analyze-image' ? 'üñºÔ∏è ƒåo chcete vedie≈• o obr√°zku?' :
                                            state.mode === 'summarizer' ? 'üìù Vlo≈æte dlh√Ω text na zhrnutie...' :
                                            state.mode === 'pdf' ? 'üìÑ ƒåo chcete vygenerova≈•? (fakt√∫ra, ≈æivotopis...)' :
                                            state.mode === 'quiz' ? '‚ùì Vlo≈æte uƒçebn√Ω materi√°l...' :
                                            'üí¨ Nap√≠≈°te spr√°vu...'
                                        }"
                                            class="flex-1 bg-slate-700/50 border border-purple-500/30 rounded-xl px-6 py-4 focus:outline-none focus:border-purple-500 text-white resize-none"
                                            rows="6"
                                            ${state.isLoading ? 'disabled' : ''}
                                        >${state.input}</textarea>
                                        <button 
                                            onclick="sendMessage()"
                                            class="bg-gradient-to-br from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl px-6 py-3 transition-all ${state.isLoading || !state.input.trim() ? 'opacity-50 cursor-not-allowed' : ''}"
                                            ${state.isLoading || !state.input.trim() ? 'disabled' : ''}
                                        >
                                            <span class="text-xl">‚û§ Odosla≈•</span>
                                        </button>
                                    ` : `
                                        <input 
                                            type="text" 
                                            id="input"
                                            value="${state.input}"
                                            oninput="state.input = this.value"
                                            onkeypress="if(event.key==='Enter') sendMessage()"
                                            placeholder="${
                                                state.mode === 'image' ? 'üé® Pop√≠≈°te obr√°zok, ktor√Ω chcete vygenerova≈•...' : 
                                                state.mode === 'chart' ? 'üìä Pop√≠≈°te d√°ta a typ grafu...' :
                                                state.mode === 'humanize' ? '‚ú® Vlo≈æte text na humaniz√°ciu...' :
                                                state.mode === 'code' ? 'üíª Vlo≈æte k√≥d na review...' :
                                                state.mode === 'presentation' ? 'üìΩÔ∏è Zadajte t√©mu prezent√°cie...' :
                                                state.mode === 'analyze-image' ? 'üñºÔ∏è ƒåo chcete vedie≈• o obr√°zku?' :
                                                state.mode === 'summarizer' ? 'üìù Vlo≈æte dlh√Ω text na zhrnutie...' :
                                                state.mode === 'pdf' ? 'üìÑ ƒåo chcete vygenerova≈•? (fakt√∫ra, ≈æivotopis...)' :
                                                state.mode === 'quiz' ? '‚ùì Vlo≈æte uƒçebn√Ω materi√°l...' :
                                                'üí¨ Nap√≠≈°te spr√°vu...'
                                            } (Enter = Odosla≈•)"
                                            class="flex-1 bg-slate-700/50 border border-purple-500/30 rounded-xl px-6 py-3 focus:outline-none focus:border-purple-500 text-white"
                                            ${state.isLoading ? 'disabled' : ''}
                                        >
                                        <button 
                                            onclick="sendMessage()"
                                            class="bg-gradient-to-br from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl px-6 py-3 transition-all ${state.isLoading || !state.input.trim() ? 'opacity-50 cursor-not-allowed' : ''}"
                                            ${state.isLoading || !state.input.trim() ? 'disabled' : ''}
                                        >
                                            <span class="text-xl">${state.mode === 'image' ? 'üé®' : state.mode === 'chart' ? 'üìä' : '‚û§'}</span>
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Scroll to bottom
            const msgs = document.getElementById('messages');
            if (msgs) msgs.scrollTop = msgs.scrollHeight;
            
            // Aplikuj syntax highlighting na v≈°etky code blocky
            setTimeout(() => {
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }, 50);
            
            // Scroll animations observer
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in-up');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);
            
            // Observe all fade-in elements
            document.querySelectorAll('.fade-in-up-delay-1, .fade-in-up-delay-2').forEach(el => {
                observer.observe(el);
            });
        }

        // Inicializ√°cia
        render();
    </script>
</body>
</html>